Here’s a first‐draft “System Audit & Optimization Guide” for your droplet. Feel free to tweak or expand each section as you see fit.

---

## 1. Overview & Security Measures

**What we’ve put in place already:**

* **PM2** managing your Node app (`csv-app`): auto-restart, monitoring
* **File permissions**: all web files owned by `www-data:www-data`, dirs `755`, files `644`
* **UFW firewall**: default deny incoming, allow only 22, 80, 443, 5173

**Remaining gaps:**

* Running Node/PM2 as **root** (should use a dedicated user)
* No HTTPS on port 80 vhost (SSL only on your custom “csv-app-ssl.conf”)
* No rate-limiting or brute-force protection
* No swap file – at 1 GB RAM and zero swap, you risk OOM

---

## 2. System Characteristics

```text
OS          Ubuntu 24.04.1 LTS (noble)
Kernel      6.8.0-36-generic
Uptime      253 days, load avg: 0.00,0.00,0.01
CPU         1 vCPU @ 2.0 GHz (Intel GenuineIntel, KVM)
RAM         961 MiB total (555 MiB used, 0 MiB swap)
Disk        8.7 GiB root (7.8 GiB used, 90% full)
Interfaces  eth0: 209.38.39.18/20, eth1: 10.110.0.11/20
```

**Implications:**

* **Single vCPU** can bottleneck on JS/TS builds (we saw 70+ modules compile).
* **No swap** means any memory spike will kill your processes.
* **Disk 90% full** – you’ll need to clean logs or expand the droplet.

---

## 3. Directory Layout & Permissions

```
/var/www/html/
└── csv-app-01/
    ├── assets/        (static images, CSS, JS)
    ├── index.html
    └── server/        (Node code & deps)
        ├── server.js
        ├── package.json
        ├── node_modules/
        └── .env
```

```bash
# Ownership & perms:
ls -ld /var/www/html/csv-app-01{,/assets,/server}
# drwxr-xr-x  www-data:www-data 755 for dirs; 644 for files
```

---

## 4. Running Services & Ports

```text
ssh      (sshd) listening on 0.0.0.0:22
Apache   (apache2) on *:80, *:443
MariaDB  (mariadbd) on 127.0.0.1:3306
Node     (csv-app) on 0.0.0.0:5173 under PM2 as root
```

```bash
ss -tulnp | grep -E ':22|:80|:443|:5173|:3306'
```

---

## 5. Apache Configuration

* **vhost 000-default.conf** (port 80)

  * `DocumentRoot /var/www/html`
  * `Alias`s for `/wpdev`, `/phpmyadmin`, `/reactdev`, `/assets`
* **vhost csv-app-ssl.conf** (port 443)

  * proxies `/csv-app-01/` → `127.0.0.1:5173/`
  * SSL cert from Let’s Encrypt under `/etc/letsencrypt/…`

```bash
apache2ctl -S   # list vhosts
apache2ctl -M   # list modules (proxy, ratelimit, etc. enabled)
```

---

## 6. Firewall & Rate-Limiting

* **UFW** rules allow 22, 80, 443, 5173 (both v4 & v6)
* **No rate limiting** on SSH or HTTP (consider `ufw limit ssh` + Apache’s `mod_ratelimit`)

```bash
sudo ufw status verbose
sudo iptables -L -n -v
```

---

## 7. Environment & Package Versions

```text
node v18.19.1
npm  v9.2.0
pm2  v6.0.8   (manages “csv-app”)
apache2 v2.4.58
```

```bash
node -v && npm -v && pm2 -v
dpkg-query -W 'apache2 nodejs npm pm2'
```

---

## 8. Scheduled Tasks & Updates

* **No user crontab** for root
* **Systemd timers** for apt-daily, logrotate, fstrim, etc.
* **Unattended-upgrades** enabled for security patches, but **no auto-reboot**

```bash
sudo systemctl list-timers --all
grep -R Unattended-Upgrade /etc/apt/apt.conf.d/
```

---

## 9. Optimization & Hardening Recommendations

1. **Create a dedicated user** (e.g. `csvapp`) and run PM2 under that account instead of root.
2. **Add a swap file** (1–2 GB) to avoid OOM on builds:

   ```bash
   fallocate -l 2G /swapfile
   chmod 600 /swapfile
   mkswap /swapfile && swapon /swapfile
   echo '/swapfile none swap sw 0 0' >> /etc/fstab
   ```
3. **Clean up disk**:

   * Remove old snaps, logs, `apt autoremove`, clear `/var/log/*.gz`
   * Consider resizing to a larger DO volume
4. **Enable HTTP/2 & compression** in Apache for all vhosts:

   ```bash
   a2enmod http2 deflate headers
   # add "Protocols h2 h2c http/1.1" to each <VirtualHost>
   ```
5. **Rate-limit SSH & HTTP**:

   * `ufw limit ssh`
   * Apache’s `mod_ratelimit` to throttle large uploads
6. **Enforce HTTPS site-wide**:

   * Redirect port 80 → 443
   * Enable HSTS header (`Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains"`)
7. **Offload static assets** to a CDN or serve from `/assets` with far-future caching:

   ```apache
   <Location /assets>
     ExpiresActive On
     ExpiresDefault "access plus 30d"
   </Location>
   ```
8. **Monitor & alert**:

   * Install `netdata` or `Prometheus` node exporter
   * Set up log‐watching and CPU/memory alerts
